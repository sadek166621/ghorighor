/*
 * loopRequest v1.0.12
 * https://github.com/zhanziyang/file-dropzone
 * 
 * Copyright (c) 2020 zhanziyang
 * Released under the MIT license
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("jquery")):"function"==typeof define&&define.amd?define(["jquery"],t):e.FileDropzone=t(e.jQuery)}(this,function(l){"use strict";l=l&&"default"in l?l.default:l;var t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")};function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){}var a={isString:function(e){return"string"==typeof e||e instanceof String},isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)},isObject:function(e){return e&&"object"===(void 0===e?"undefined":t(e))&&!this.isArray(e)},addUnique:function(e,t){return e.indexOf(t)<0&&e.push(t),e},remove:function(e,t){var i=e.indexOf(t);return 0<=i&&e.splice(i,1),e},assign:function(e,t){if(!e||!t)return e;for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);return e},without:function(e,t){for(var i,n=[],o=0,s=e.length;o<s;o++)(i=e[o])!==t&&n.push(i);return n},fileTypeValid:function(e,t){if(!t)return!0;var i=t.replace(/\/.*$/,""),n=t.split(","),o=!0,s=!1,r=void 0;try{for(var l,a=n[Symbol.iterator]();!(o=(l=a.next()).done);o=!0){var h=l.value,p=h.trim();if(/^\./.test(p)){if(e.name.toLowerCase().split(".").pop()===p.toLowerCase())return!0}else if(/\/\*$/.test(p)){if(e.type.replace(/\/.*$/,"")===i)return!0}else if(e.type===h)return!0}}catch(e){s=!0,r=e}finally{try{!o&&a.return&&a.return()}finally{if(s)throw r}}return!1},eventHasFile:function(e){var t=e.dataTransfer||e.originalEvent.dataTransfer;if(t.types)for(var i=0,n=t.types.length;i<n;i++)if("Files"==t.types[i])return!0;return!1},getFilesFromEvent:function(e){var t=e.dataTransfer||e.originalEvent.dataTransfer,i=[];if(t.items&&t.items.length)for(var n=0,o=t.items.length;n<o;n++){var s=t.items[n];"file"===s.kind&&i.push(s.getAsFile())}else i=t.files;return i}},i=[],h=function(e){i=e},s=0,r={target:"",fileHoverClass:"dropzone--file-hover",clickable:!0,multiple:!0,paramName:"file",accept:"",capture:!1,unique:!1,noFolder:!0,forceReplace:!1,onChange:e,onEnter:e,onLeave:e,onHover:e,onDrop:e,onFolderFound:e,onInvalid:e,beforeAdd:e};function p(e,t){o(this,p);var i=t||{},n=l(e);if(a.isString(e)||!a.isObject(e)||e instanceof l||e instanceof Element||(n=l((i=e||{}).target)),!n||n.length<=0)throw new Error("No matched element.");this.element=n,this.options=Object.assign(JSON.parse(JSON.stringify(r)),i),this.disabled=!1,this.fileInput=null,this.multiple=!1,this.init()}function u(e){var t,i,n=this,o=[],s=[];e.forEach(function(e){a.fileTypeValid(e,n.options.accept)?(!n.options.unique||n.getFiles().indexOf(e)<0)&&o.push(e):s.push(e)}),s.length&&this.options.onInvalid&&this.options.onInvalid.bind(this)(s),o[0]&&(this.multiple||(o=o.slice(0,1)),t=!0,!this.options.beforeAdd||"boolean"==typeof(i=this.options.beforeAdd.bind(this)(o))&&(t=i),t&&(!this.multiple||this.options.forceReplace?h.bind(this)(o):h.bind(this)(this.getFiles().concat(o)),this.options.onChange&&this.options.onChange.bind(this)()))}function f(e){s--,!this.disabled&&a.eventHasFile(e)&&(e.preventDefault(),e.stopPropagation(),0===s&&(this.options.onLeave&&this.options.onLeave.bind(this)(e),this.element.removeClass(this.options.fileHoverClass)))}return function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(p,[{key:"init",value:function(){h.bind(this)([]),this.clickable=this.options.clickable,this.clickable&&this.enableClick(),this.element[0].addEventListener("click",function(e){this.disabled||this.clickable&&this.openFileChooser()}.bind(this)),this.multiple="boolean"!=typeof this.options.multiple||this.options.multiple,this.fileInput=l('<input type="file" hidden name="'+this.options.paramName+'" class="'+this.options.paramName+'" >'),this.element.next(this.fileInput),this.multiple&&this.fileInput.attr("multiple","multiple"),this.options.capture&&this.fileInput.attr("capture",this.options.capture),this.options.accept&&this.fileInput.attr("accept",this.options.accept),this.element.on("dragenter",function(e){s++,!this.disabled&&a.eventHasFile(e)&&(e.preventDefault(),e.stopPropagation(),1==s&&(this.options.onEnter&&this.options.onEnter.bind(this)(e),this.element.addClass(this.options.fileHoverClass)))}.bind(this)).on("dragleave",f.bind(this)).on("dragend",f.bind(this)).on("dragover",function(e){!this.disabled&&a.eventHasFile(e)&&(e.preventDefault(),this.options.onHover&&this.options.onHover.bind(this)(e))}.bind(this)).on("drop",function(e){var t;s--,!this.disabled&&a.eventHasFile(e)&&(e.preventDefault(),e.stopPropagation(),this.options.onDrop&&this.options.onDrop.bind(this)(e),this.element.removeClass(this.options.fileHoverClass),t=function(e){for(var t=[],i=[],n=0,o=e.length;n<o;n++){var s=e[n];s.type||s.size%4096!=0?i.push(s):t.push(s)}return 0<t.length&&this.options.onFolderFound&&this.options.onFolderFound.bind(this)(t),this.options.noFolder?i:e}.bind(this)(a.getFilesFromEvent(e)),u.bind(this)(t))}.bind(this));var r=this;this.fileInput.on("click",function(e){e.stopPropagation()}).on("change",function(e){if(!r.disabled){for(var t=e.target.files,i=[],n=0,o=t.length;n<o;n++){var s=t[n];s instanceof File&&i.push(s)}u.bind(r)(i),r.options.unique||l(this).val("")}}),window.__dropzone_styled_inserted||(l("<style>\n      .dropzone--clickable { cursor: pointer; }\n      .dropzone--file-hover { box-shadow: inset 0 0 10px #aaa; }\n    </style>").appendTo("head"),window.__dropzone_styled_inserted=!0)}},{key:"addFiles",value:function(e){u.bind(this)(e)}},{key:"getFiles",value:function(){return i}},{key:"removeFile",value:function(e){var t,i,n=this.getFiles(),o=n.length;return e instanceof File?(t=e,i=a.without(n,t),h.bind(this)(i)):"number"==typeof e&&(t=n.splice(e,1)[0]),this.getFiles().length===o-1?(this.options.onChange&&this.options.onChange.bind(this)(),t):null}},{key:"pop",value:function(){var e=this.getFiles();if(!e.length)return null;var t=e.pop();return h.bind(this)(e),this.options.onChange&&this.options.onChange.bind(this)(),t}},{key:"shift",value:function(){var e=this.getFiles();if(!e.length)return null;var t=e.shift();return h.bind(this)(e),this.options.onChange&&this.options.onChange.bind(this)(),t}},{key:"openFileChooser",value:function(){this.fileInput.click()}},{key:"clearAll",value:function(){h.bind(this)([]),this.options.onChange&&this.options.onChange.bind(this)()}},{key:"disable",value:function(){this.disabled=!0,this.element.addClass("dropzone--disabled"),this.fileInput.prop("disabled",!0)}},{key:"enable",value:function(){this.disabled=!1,this.element.removeClass("dropzone--disabled"),this.fileInput.prop("disabled",!1)}},{key:"disableClick",value:function(){this.element.removeClass("dropzone--clickable"),this.clickable=!1}},{key:"enableClick",value:function(){this.element.addClass("dropzone--clickable"),this.clickable=!0}}],[{key:"getFileSize",value:function(e,t){var i=1<arguments.length&&void 0!==t?t:"b";if(!(e instanceof File))throw new TypeError('First argument "file" should be a File instance.');if(i&&"string"==typeof i||(i="b"),"b"==i)return e.size;var n=["b","kb","mb","gb","tb"].indexOf(i.toLowerCase());if(n<0)throw new TypeError('The unit should be one of "tb", "gb", "mb", "kb" and "b", the default value is "b"');return e.size/Math.pow(1024,n)}}]),p});
